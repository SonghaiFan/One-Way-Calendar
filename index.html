<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>One-Way Calendar</title>
    <meta name="referrer" content="no-referrer" />
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Noto+Serif+SC:wght@300;400;600;700&family=Inter:wght@300;400;500&display=swap" rel="stylesheet">
    
    <!-- React & ReactDOM (UMD for static usage) -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    
    <!-- Babel Standalone for in-browser JSX compilation -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <style>
      body {
        font-family: 'Inter', sans-serif;
        background-color: #f3f4f6;
      }
      .serif {
        font-family: 'Noto Serif SC', serif;
      }
      /* Custom scrollbar hiding */
      .no-scrollbar::-webkit-scrollbar {
        display: none;
      }
      .no-scrollbar {
        -ms-overflow-style: none;
        scrollbar-width: none;
      }
      .perspective-1000 {
        perspective: 1000px;
      }
    </style>
  <script type="importmap">
{
  "imports": {
    "react": "https://aistudiocdn.com/react@^19.2.0",
    "react-dom/": "https://aistudiocdn.com/react-dom@^19.2.0/",
    "react/": "https://aistudiocdn.com/react@^19.2.0/",
    "lucide-react": "https://aistudiocdn.com/lucide-react@^0.555.0"
  }
}
</script>
</head>
  <body>
    <div id="root"></div>

    <script type="text/babel" data-presets="react,typescript">
      const { useState, useEffect, useCallback } = React;
      const { createRoot } = ReactDOM;

      // --- Icons (Inlined to avoid UMD issues) ---
      const IconBase = ({ children, className, ...props }) => (
        <svg 
          xmlns="http://www.w3.org/2000/svg" 
          width="24" 
          height="24" 
          viewBox="0 0 24 24" 
          fill="none" 
          stroke="currentColor" 
          strokeWidth="2" 
          strokeLinecap="round" 
          strokeLinejoin="round" 
          className={className}
          {...props}
        >
          {children}
        </svg>
      );

      const Loader2 = (props) => (
        <IconBase {...props}><path d="M21 12a9 9 0 1 1-6.219-8.56" /></IconBase>
      );
      const RefreshCw = (props) => (
        <IconBase {...props}>
          <path d="M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8" />
          <path d="M21 3v5h-5" />
          <path d="M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16" />
          <path d="M8 16H3v5" />
        </IconBase>
      );
      const AlertCircle = (props) => (
        <IconBase {...props}>
          <circle cx="12" cy="12" r="10" />
          <line x1="12" x2="12" y1="8" y2="12" />
          <line x1="12" x2="12.01" y1="16" y2="16" />
        </IconBase>
      );
      const ChevronLeft = (props) => (
        <IconBase {...props}><path d="m15 18-6-6 6-6" /></IconBase>
      );
      const ChevronRight = (props) => (
        <IconBase {...props}><path d="m9 18 6-6-6-6" /></IconBase>
      );
      const CalendarIcon = (props) => (
        <IconBase {...props}>
          <rect width="18" height="18" x="3" y="4" rx="2" ry="2" />
          <line x1="16" x2="16" y1="2" y2="6" />
          <line x1="8" x2="8" y1="2" y2="6" />
          <line x1="3" x2="21" y1="10" y2="10" />
        </IconBase>
      );
      const RotateCcw = (props) => (
        <IconBase {...props}>
          <path d="M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 12" />
          <path d="M3 5v7h7" />
        </IconBase>
      );

      // --- Constants & Enums ---
      const LoadingState = {
        IDLE: 'IDLE',
        LOADING: 'LOADING',
        SUCCESS: 'SUCCESS',
        ERROR: 'ERROR'
      };

      // --- Utils ---
      const formatDateForApi = (date) => {
        const year = date.getFullYear().toString();
        // Month is 0-indexed in JS
        const month = (date.getMonth() + 1).toString().padStart(2, '0');
        const day = date.getDate().toString().padStart(2, '0');
        
        return {
          year,
          dateStr: `${month}${day}`
        };
      };

      const getCalendarDate = (date) => {
        return {
          year: date.getFullYear().toString(),
          month: (date.getMonth() + 1).toString().padStart(2, '0'),
          day: date.getDate().toString().padStart(2, '0'),
          fullDate: date
        };
      };

      const isValidDate = (d) => {
        return d instanceof Date && !isNaN(d.getTime());
      };

      // --- Hooks ---
      const PROXY_BASE = 'https://wsrv.nl/?url=';
      const OWSPACE_BASE = 'http://img.owspace.com/Public/uploads/Download/';

      const useOneWayUrl = (date) => {
        const [imageUrl, setImageUrl] = useState('');
        const [loadingState, setLoadingState] = useState(LoadingState.IDLE);

        useEffect(() => {
          let isMounted = true;
          setLoadingState(LoadingState.LOADING);

          const { year, dateStr } = formatDateForApi(date);
          
          // Construct the target URL
          const targetUrl = `${OWSPACE_BASE}${year}/${dateStr}.jpg`;
          
          // Construct the Proxy URL
          // We append &output=webp for better performance if possible, 
          // and &q=90 for quality.
          const proxyUrl = `${PROXY_BASE}${targetUrl}&output=webp&q=85`;

          // Preload image to check existence
          const img = new Image();
          img.src = proxyUrl;

          img.onload = () => {
            if (isMounted) {
              setImageUrl(proxyUrl);
              setLoadingState(LoadingState.SUCCESS);
            }
          };

          img.onerror = () => {
            if (isMounted) {
              setLoadingState(LoadingState.ERROR);
            }
          };

          return () => {
            isMounted = false;
            img.onload = null;
            img.onerror = null;
          };
        }, [date]);

        return { imageUrl, loadingState, retry: () => setLoadingState(LoadingState.LOADING) };
      };

      // --- Components ---
      
      const PaperCard = ({ currentDate, imageUrl, loadingState, onRetry }) => {
        const [isFlipped, setIsFlipped] = useState(false);

        useEffect(() => {
          setIsFlipped(false);
        }, [currentDate]);

        return (
          <div className="relative w-full max-w-md mx-auto perspective-1000">
            {/* Binding Mechanism */}
            <div className="absolute -top-6 left-0 w-full flex justify-evenly z-20 px-8">
              {[1, 2].map((i) => (
                <div key={i} className="relative group">
                  {/* Ring hole */}
                  <div className="w-4 h-4 rounded-full bg-gray-800 shadow-[inset_0_2px_4px_rgba(0,0,0,0.8)] border-b border-gray-600/50 relative top-6 z-0"></div>
                  {/* Metal Ring */}
                  <div className="absolute -top-5 left-1/2 -translate-x-1/2 w-2 h-12 bg-gradient-to-b from-gray-300 via-gray-100 to-gray-400 rounded-full shadow-lg z-30 ring-1 ring-gray-400/50"></div>
                </div>
              ))}
            </div>

            {/* Main Paper Board */}
            <div className="relative bg-[#fdfbf7] rounded-sm shadow-[0_10px_40px_-10px_rgba(0,0,0,0.2),0_2px_10px_rgba(0,0,0,0.1)] overflow-hidden min-h-[600px] flex flex-col transform transition-all duration-300">
              
              {/* Perforated Top */}
              <div className="h-12 bg-[#fdfbf7] border-b-2 border-dashed border-gray-200 w-full relative z-10"></div>

              {/* Content Area */}
              <div className="flex-1 p-6 flex flex-col items-center justify-center relative">
                
                {/* Paper Texture Overlay (CSS Pattern) */}
                <div className="absolute inset-0 opacity-[0.03] pointer-events-none" style={{ backgroundImage: 'radial-gradient(#000 0.5px, transparent 0.5px)', backgroundSize: '20px 20px' }}></div>

                {loadingState === LoadingState.LOADING && (
                  <div className="flex flex-col items-center justify-center space-y-4 text-gray-400 animate-pulse">
                    <Loader2 className="w-10 h-10 animate-spin" />
                    <span className="text-sm tracking-widest uppercase font-medium">Loading Wisdom...</span>
                  </div>
                )}

                {loadingState === LoadingState.ERROR && (
                  <div className="flex flex-col items-center justify-center space-y-4 text-gray-500">
                    <AlertCircle className="w-12 h-12 text-gray-300" />
                    <p className="text-center font-serif text-gray-600 max-w-[200px]">
                      Even the calendar needs a rest sometimes. No page found for this date.
                    </p>
                    <button 
                      onClick={onRetry}
                      className="flex items-center space-x-2 px-4 py-2 bg-gray-100 hover:bg-gray-200 rounded-full text-sm transition-colors"
                    >
                      <RefreshCw className="w-4 h-4" />
                      <span>Try Again</span>
                    </button>
                  </div>
                )}

                {loadingState === LoadingState.SUCCESS && (
                   <div className="w-full h-full flex flex-col">
                     <img 
                       src={imageUrl} 
                       alt={`One Way Calendar ${currentDate.year}-${currentDate.month}-${currentDate.day}`}
                       className="w-full h-auto object-contain mix-blend-multiply filter contrast-[1.05] drop-shadow-sm"
                       draggable={false}
                     />
                   </div>
                )}
              </div>

              {/* Bottom Metadata / Footer */}
              <div className="h-12 flex items-center justify-center text-gray-300 text-xs tracking-[0.2em] font-light border-t border-gray-100/50">
                 OWSPACE {currentDate.year}
              </div>
            </div>

            {/* Stacked Paper Effect (Pages behind) */}
            <div className="absolute top-2 left-1 right-1 h-full bg-white rounded-sm shadow-sm -z-10 rotate-[0.5deg]"></div>
            <div className="absolute top-3 left-2 right-2 h-full bg-white rounded-sm shadow-sm -z-20 rotate-[-0.5deg]"></div>
          </div>
        );
      };

      const Controls = ({ 
        onPrev, 
        onNext, 
        onToday, 
        onDateChange, 
        currentDateStr,
        isToday
      }) => {
        return (
          <div className="fixed bottom-0 left-0 w-full bg-white/80 backdrop-blur-md border-t border-gray-200 p-4 pb-6 sm:pb-4 z-50 transition-all duration-300">
            <div className="max-w-md mx-auto flex items-center justify-between">
              
              <button 
                onClick={onPrev}
                className="p-3 rounded-full hover:bg-gray-100 text-gray-600 transition-colors active:scale-95"
                aria-label="Previous Day"
              >
                <ChevronLeft className="w-6 h-6" />
              </button>

              <div className="flex items-center space-x-3">
                <div className="relative group">
                  <input 
                    type="date" 
                    value={currentDateStr}
                    onChange={onDateChange}
                    className="absolute inset-0 opacity-0 cursor-pointer w-full h-full z-10"
                  />
                  <button className="flex items-center space-x-2 px-4 py-2 bg-gray-50 border border-gray-200 rounded-full text-sm font-medium text-gray-700 group-hover:bg-gray-100 transition-colors shadow-sm">
                    <CalendarIcon className="w-4 h-4 text-gray-500" />
                    <span className="serif tracking-wide">{currentDateStr}</span>
                  </button>
                </div>

                {!isToday && (
                  <button 
                    onClick={onToday}
                    className="p-2 text-gray-400 hover:text-gray-900 transition-colors"
                    title="Return to Today"
                  >
                    <RotateCcw className="w-5 h-5" />
                  </button>
                )}
              </div>

              <button 
                onClick={onNext}
                className="p-3 rounded-full hover:bg-gray-100 text-gray-600 transition-colors active:scale-95"
                aria-label="Next Day"
              >
                <ChevronRight className="w-6 h-6" />
              </button>
            </div>
          </div>
        );
      };

      // --- Main App ---
      const App = () => {
        const [currentDate, setCurrentDate] = useState(new Date());
        const { imageUrl, loadingState, retry } = useOneWayUrl(currentDate);

        useEffect(() => {
          const handleKeyDown = (e) => {
            if (e.key === 'ArrowLeft') handlePrevDay();
            if (e.key === 'ArrowRight') handleNextDay();
          };
          window.addEventListener('keydown', handleKeyDown);
          return () => window.removeEventListener('keydown', handleKeyDown);
        }, [currentDate]);

        const handlePrevDay = useCallback(() => {
          setCurrentDate(prev => {
            const newDate = new Date(prev);
            newDate.setDate(prev.getDate() - 1);
            return newDate;
          });
        }, []);

        const handleNextDay = useCallback(() => {
          setCurrentDate(prev => {
            const newDate = new Date(prev);
            newDate.setDate(prev.getDate() + 1);
            return newDate;
          });
        }, []);

        const handleToday = useCallback(() => {
          setCurrentDate(new Date());
        }, []);

        const handleDateChange = useCallback((e) => {
          const newDate = new Date(e.target.value);
          if (isValidDate(newDate)) {
            setCurrentDate(newDate);
          }
        }, []);

        const dateStr = currentDate.toISOString().split('T')[0];
        const isToday = new Date().toDateString() === currentDate.toDateString();

        return (
          <div className="min-h-screen bg-[#f0f2f5] text-gray-800 flex flex-col overflow-hidden relative selection:bg-gray-300">
            
            {/* Background Aesthetic */}
            <div className="absolute inset-0 z-0 bg-gradient-to-t from-gray-200 to-[#f3f4f6]"></div>

            {/* Header */}
            <header className="relative z-10 pt-8 pb-4 text-center">
              <h1 className="text-xl font-serif font-bold text-gray-800 tracking-widest uppercase">
                One Way
              </h1>
              <p className="text-[10px] text-gray-500 tracking-[0.3em] uppercase mt-1">
                Calendar
              </p>
            </header>

            {/* Main Card Area */}
            <main className="relative z-10 flex-1 flex items-start justify-center pt-6 pb-32 px-4 overflow-y-auto no-scrollbar">
              <PaperCard 
                currentDate={getCalendarDate(currentDate)}
                imageUrl={imageUrl}
                loadingState={loadingState}
                onRetry={retry}
              />
            </main>

            {/* Controls */}
            <Controls 
              onPrev={handlePrevDay}
              onNext={handleNextDay}
              onToday={handleToday}
              onDateChange={handleDateChange}
              currentDateStr={dateStr}
              isToday={isToday}
            />

          </div>
        );
      };

      // --- Mount ---
      const root = createRoot(document.getElementById('root'));
      root.render(<App />);
    </script>
  </body>
</html>